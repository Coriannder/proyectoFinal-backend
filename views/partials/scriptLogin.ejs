<script>

const postLogin =  async (email, password) => {
        let response = await fetch('/login', {
            method: 'POST',
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json ; charset=utf-8' },
            body: JSON.stringify({email, password})
        }).then(res => res.json())
        console.log('resPost----------------' , response)
        return response
    }

    const getId = async (token) => {
        const response = await fetch('/user/id', {
            method: 'GET',
            headers: {
                'Authorization': `Bearer ${token}`
            }
        }).then(res => res.json())
        return response.id
    }


    const getHome =  async ( id , token ) => {

        if(!token) throw new Error('No se encontro token')
        const response = await fetch(`/home?id=${id}`)
        .catch(err => {throw new Error(err)})
        if(!response.ok) redirect('/login')
        window.location.href = `/home?id=${id}`
    }


        const handleSubmit = async (event) => {

            event.preventDefault('')

            const email = document.getElementById('email').value
            const password = document.getElementById('password').value
            const response = await postLogin(email, password)
            
            if(!response.token) return window.location.href = '/error'
            localStorage.setItem('token', response.token)
            const id = await getId(response.token)

            if(!id) window.location.href = "/login"
            getHome(id , response.token)
        }

</script>